# Terraform Plugin Code Generation for Cisco NDFC
This generation uses home grown `tfgenerator` and hashicorp's `tfplugin-generate` tools
This tool relies on `tfplugin-generate` framework from Hashicorp for generating the resource/datasource schema

## Prerequisites 
Install **Terraform Framework Code Generator**      
https://developer.hashicorp.com/terraform/plugin/code-generation/framework-generator    
```
go install github.com/hashicorp/terraform-plugin-codegen-framework/cmd/tfplugingen-framework@latest    
```
Download and install generator tool

Note: The generator code is private. Send a request to muralidm@cisco.com for access.

```          
Repo: https://github.com/mdmohan/tfgenerator    
Clone the repo and run `go install .`    
Binary  `$GOPATH/bin/generator`
```
Install `addlicence` tool (Note this has customizations, so use only the forked repo)     
```
https://github.com/mdmohan/addlicense
Clone the repo and run `go install .`
Binary `$GOPATH/bin/addlicense`
```

Install `tfpugin-docs`
```
https://github.com/hashicorp/terraform-plugin-docs
```

## Workflow
For detailed working of the `tfgenerator` tool, check the documentation in https://github.com/mdmohan/tfgenerator     

### Steps to generate schema and supporting code for resources and data sources

* Create the yaml definition file for the resource under `generator/defs` folder     
See  [fields.md](fields.md) for detailed help on the fields in yaml file.    
* Add the new yaml file to the list in `generator/defs/defs.yaml`. The tool only processes the files in this list.         
* Run `go generate`     
** Note: Before Running `go generate` please make sure that `tfgenerator` is on `master` branch and up to date **    
** Always remember to build `tfgenerator` after `git pull`**     

On successful completion, following files are generated        

* internal/provider/resources/resource_<resource_name>/<resource_name>_resource_gen.go
File generated by terraform plugin which contains the Schema definitions        

* internal/provider/resources/resource_<resource_name>/resource_codec_gen.go       
This file contains the code to convert the TF Model structure to native Go structure       
This is useful for generating NDFC json payloads, and also converting NDFC response JSON back to model struct       

* internal/provider/resources/resource_<resource_name>/resource_compare_gen.go      
Useful for bulk resources, which carry multiple resource objects within       
For example VRF/Network where single resource can hold multiple VRFs or networks      
Auto generated functions for comparing model values, similar to Go's DeepEqual        

* internal/provider/testutils_<resource_name>_test.go 
Contains helper functions that can be called from Terraform Acceptance tests for validating resource attributes

Report any errors seen to muralidm@cisco.com

### Important
DONOT forget to Commit following files      
* The resource yaml file added in generator/defs and changes to generator/defs/defs.yaml
* Code generated in internal/provider/resources/resource_<name>
* Code generated in internal/provider/datasources/datasource_<name>
* `_test.go` files generated under internal/provider






